Index: core/src/com/sab/littleh/campaign/visual_novel/dialogue/VnDialogue.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.sab.littleh.campaign.visual_novel.dialogue;\r\n\r\nimport com.badlogic.gdx.graphics.Color;\r\nimport com.badlogic.gdx.math.MathUtils;\r\nimport com.badlogic.gdx.math.Rectangle;\r\nimport com.sab.littleh.LittleH;\r\nimport com.sab.littleh.campaign.visual_novel.menu.VnDialogueMenu;\r\nimport com.sab.littleh.campaign.visual_novel.particle.HeartParticle;\r\nimport com.sab.littleh.game.level.Level;\r\nimport com.sab.littleh.mainmenu.MainMenu;\r\nimport com.sab.littleh.mainmenu.MenuButton;\r\nimport com.sab.littleh.util.Graphics;\r\nimport com.sab.littleh.util.Images;\r\nimport com.sab.littleh.util.Menu;\r\nimport com.sab.littleh.util.Patch;\r\nimport com.sab.littleh.util.SoundEngine;\r\nimport com.sab.littleh.util.dialogue.Dialogue;\r\n\r\nimport java.awt.*;\r\nimport java.util.List;\r\nimport java.util.Map;\r\n\r\npublic class VnDialogue extends Dialogue {\r\n   private static Patch dialogue;\r\n   private static Patch playerDialogue;\r\n   private static Patch playerDialogueColor;\r\n   private static Patch playerDialogueColorAA;\r\n   private String previousPortrait;\r\n   private String previousText;\r\n   public static void load() {\r\n      dialogue = new Patch(\"campaign/visual_novel/menu/dialogue_box.png\", 30, 24, 14, 8);\r\n      playerDialogue = new Patch(\"campaign/visual_novel/menu/player_dialogue_box.png\", 30, 24, 14, 8);\r\n      playerDialogueColor = new Patch(\"campaign/visual_novel/menu/player_dialogue_box_color.png\", 30, 24, 14, 8);\r\n      playerDialogueColorAA = new Patch(\"campaign/visual_novel/menu/player_dialogue_box_color_aa.png\", 30, 24, 14, 8);\r\n   }\r\n   public VnDialogue(String[] text, String[] characterNames, String[] fileNames, Map<String, Integer> breakPoints) {\r\n      super(text, characterNames, fileNames, breakPoints);\r\n      started = false;\r\n   }\r\n\r\n   @Override\r\n   public void setDialogueOptions(String[] options, String[] breakPoints) {\r\n      MenuButton[] buttons = new MenuButton[options.length];\r\n      for (int i = 0; i < options.length; i++) {\r\n         final int finalI = i;\r\n         // Doesn't really support more than 4 options\r\n         buttons[i] = new MenuButton(\"vn_button_full\", options[i], 0, 0, (options.length % 2 != 0 && finalI == options.length - 2) ? 608 : 300, 50, () -> {\r\n            String oldPortrait = getPortrait();\r\n            String oldText = getLastBlock();\r\n//            System.out.println(oldPortrait);\r\n//            System.out.println(previousPortrait);\r\n//            System.out.println(oldPortrait.contains(\"player\") == previousPortrait.contains(\"player\"));\r\n            runCommand(\"gB\", breakPoints[finalI]);\r\n            dialogueOptions = null;\r\n            if (previousPortrait == null ||\r\n                    !(oldPortrait.contains(\"player\") == getPortrait().contains(\"player\"))) {\r\n               previousPortrait = oldPortrait;\r\n               previousText = oldText;\r\n            }\r\n         });\r\n      }\r\n      dialogueOptions = new Menu<MenuButton>(buttons, 300, 56, 8);\r\n      update();\r\n   }\r\n\r\n   @Override\r\n   public void reset() {\r\n      super.reset();\r\n      // Dating menus have a slower default\r\n      runCommand(\"gF\", \"0.75\");\r\n   }\r\n\r\n   @Override\r\n   public void update() {\r\n      if (dialogueOptions != null) {\r\n         dialogueOptions.setMenuRectangle(MainMenu.relZeroX() + 20, MainMenu.relZeroY() + 32 + 160, 73 * 2, false);\r\n         dialogueOptions.forEach(MenuButton::update);\r\n      }\r\n   }\r\n\r\n   @Override\r\n   public void nextBlock() {\r\n      boolean update = finishedBlock();\r\n      String oldPortrait = getPortrait();\r\n      String oldText = getLastBlock();\r\n      super.nextBlock();\r\n      if (update) {\r\n         if (previousPortrait == null ||\r\n                 !(oldPortrait.contains(\"player\") == getPortrait().contains(\"player\"))) {\r\n            previousPortrait = oldPortrait;\r\n            previousText = oldText;\r\n         }\r\n      }\r\n   }\r\n\r\n   @Override\r\n   public void runCommand(String command, String parameter) {\r\n      // Spawn particle\r\n      if (command.equals(\"sP\")) {\r\n         if (LittleH.program.getMenu() instanceof VnDialogueMenu) {\r\n            VnDialogueMenu menu = (VnDialogueMenu) LittleH.program.getMenu();\r\n            String[] params = parameter.split(\"\\\\|\");\r\n            boolean isPlayer = getPortrait().contains(\"player\");\r\n            String type = params[0].trim();\r\n            int count = Integer.parseInt(params[1].trim());\r\n            for (int i = 0; i < count; i++) {\r\n               if (type.equals(\"heart\")) {\r\n                  if (isPlayer) {\r\n                     menu.addParticle(new HeartParticle(MainMenu.relZeroX() + 64 + MathUtils.random(512), MainMenu.relZeroY() + 160 + 32 + MathUtils.random(512)));\r\n                  } else {\r\n                     menu.addParticle(new HeartParticle(-MainMenu.relZeroX() - 512 - 64 + MathUtils.random(512), MainMenu.relZeroY() + 160 + 32 + MathUtils.random(512)));\r\n                  }\r\n               }\r\n            }\r\n         }\r\n      // Add (particle) spawner\r\n      } else if (command.equals(\"aS\")) {\r\n         if (LittleH.program.getMenu() instanceof VnDialogueMenu) {\r\n            VnDialogueMenu menu = (VnDialogueMenu) LittleH.program.getMenu();\r\n            menu.addParticleSpawner(parameter);\r\n         }\r\n         // Clear (particle) spawners\r\n      } else if (command.equals(\"cS\")) {\r\n         if (LittleH.program.getMenu() instanceof VnDialogueMenu) {\r\n            VnDialogueMenu menu = (VnDialogueMenu) LittleH.program.getMenu();\r\n            menu.clearParticleSpawners();\r\n         }\r\n      }  else {\r\n         super.runCommand(command, parameter);\r\n      }\r\n   }\r\n\r\n   public void render(Graphics g, boolean background) {\r\n      if (!background) {\r\n         g.resetTint();\r\n         if (previousPortrait != null)\r\n            render(g, true);\r\n      } else {\r\n         g.setTint(new Color(0.5f, 0.5f, 0.5f, 0.5f));\r\n      }\r\n      String portrait = background ? previousPortrait : getPortrait();\r\n      boolean isPlayer = portrait.contains(\"player\");\r\n      if (isPlayer) {\r\n         g.setColor(Images.getHColor());\r\n         g.draw(Images.getImage(portrait + \"_color.png\"), MainMenu.relZeroX() + 64, MainMenu.relZeroY() + 160, 512, 512);\r\n         g.resetColor();\r\n         g.draw(Images.getImage(portrait + \".png\"), MainMenu.relZeroX() + 64, MainMenu.relZeroY() + 160, 512, 512);\r\n      } else {\r\n         g.draw(Images.getImage(portrait), -MainMenu.relZeroX() - 512 - 64 + 512, MainMenu.relZeroY() + 160, -512, 512);\r\n      }\r\n\r\n      Rectangle textArea = new Rectangle(MainMenu.relZeroX() + (isPlayer ? 0 : 640), MainMenu.relZeroY() + 32, LittleH.program.getWidth() - 640, 160);\r\n      if (isPlayer) {\r\n         g.drawPatch(playerDialogue, textArea, 4);\r\n         g.setColor(Images.getHColor(0, -0.25f, 0f));\r\n         g.drawPatch(playerDialogueColor, textArea, 4);\r\n         g.setColor(Images.getHColor(0, -0.67f, 0f));\r\n         g.drawPatch(playerDialogueColorAA, textArea, 4);\r\n         g.resetColor();\r\n      } else {\r\n         g.drawPatch(dialogue, textArea, 4);\r\n      }\r\n      textArea.y -= 32;\r\n      textArea.x += isPlayer ? 32 : 12;\r\n      textArea.width -= 32;\r\n      String text = background ? previousText : getLastBlock();\r\n      if (!background) {\r\n         if (text != null)\r\n            g.drawString(text, LittleH.font, textArea, 8, LittleH.defaultFontScale * 0.9f, -1, 1);\r\n         if (isPlayer)\r\n            g.drawString(getName(), LittleH.borderedFont, MainMenu.relZeroX() + 64 + 256, MainMenu.relZeroY() + 160 + 64, LittleH.defaultFontScale * 0.95f, 0);\r\n         else\r\n            g.drawString(getName(), LittleH.borderedFont, -MainMenu.relZeroX() - 512 - 64 + 256, MainMenu.relZeroY() + 160 + 64, LittleH.defaultFontScale * 0.95f, 0);\r\n      }\r\n      g.resetTint();\r\n\r\n      if (dialogueOptions != null) {\r\n         Rectangle[] buttons = dialogueOptions.getItemButtons();\r\n\r\n         for (int i = 0; i < dialogueOptions.items.length; i++) {\r\n            dialogueOptions.getItem(i).x = buttons[i].x;\r\n            dialogueOptions.getItem(i).y = buttons[i].y;\r\n         }\r\n         dialogueOptions.forEach(menuButton -> menuButton.render(g, 4, 0.8f));\r\n      }\r\n\r\n      if (finishedBlock() && autoTime > 120) {\r\n         LittleH.borderedFont.setColor(new Color(1, 1, 1, MathUtils.sinDeg(autoTime * 2) / 2f + 0.5f));\r\n         if (finished()) {\r\n            g.drawString(\"Press 'select' or click to end dialogue\", LittleH.borderedFont, -MainMenu.relZeroX() - 4, MainMenu.relZeroY() + 16, LittleH.defaultFontScale * 0.75f, 1);\r\n         } else {\r\n            g.drawString(\"Press 'select' or click to continue\", LittleH.borderedFont, -MainMenu.relZeroX() - 4, MainMenu.relZeroY() + 16, LittleH.defaultFontScale * 0.75f, 1);\r\n         }\r\n      } else if (!started) {\r\n         LittleH.borderedFont.setColor(new Color(1, 1, 1, MathUtils.sinDeg(LittleH.getTick() * 2) / 2f + 0.5f));\r\n         g.drawString(\"Press 'select' or click to start dialogue\", LittleH.borderedFont, -MainMenu.relZeroX() - 4, MainMenu.relZeroY() + 16, LittleH.defaultFontScale * 0.75f, 1);\r\n      }\r\n      LittleH.borderedFont.setColor(Color.WHITE);\r\n   }\r\n}
===================================================================
diff --git a/core/src/com/sab/littleh/campaign/visual_novel/dialogue/VnDialogue.java b/core/src/com/sab/littleh/campaign/visual_novel/dialogue/VnDialogue.java
--- a/core/src/com/sab/littleh/campaign/visual_novel/dialogue/VnDialogue.java	
+++ b/core/src/com/sab/littleh/campaign/visual_novel/dialogue/VnDialogue.java	
@@ -162,7 +162,7 @@
       }
       textArea.y -= 32;
       textArea.x += isPlayer ? 32 : 12;
-      textArea.width -= 32;
+      textArea.width -= 40;
       String text = background ? previousText : getLastBlock();
       if (!background) {
          if (text != null)
Index: core/src/com/sab/littleh/campaign/visual_novel/menu/VnTitleMenu.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.sab.littleh.campaign.visual_novel.menu;\r\n\r\nimport com.badlogic.gdx.Input;\r\nimport com.sab.littleh.LittleH;\r\nimport com.sab.littleh.mainmenu.MainMenu;\r\nimport com.sab.littleh.mainmenu.MenuButton;\r\nimport com.sab.littleh.mainmenu.TitleMenu;\r\nimport com.sab.littleh.util.*;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class VnTitleMenu extends MainMenu {\r\n    private List<MenuButton> buttons;\r\n    static {\r\n        Patch.cachePatch(\"vn_menu\",\r\n                new Patch(\"campaign/visual_novel/menu/menu.png\", 9, 9, 3, 3));\r\n        Patch.cachePatch(\"vn_menu_indented\",\r\n                new Patch(\"campaign/visual_novel/menu/menu_indented.png\", 9, 9, 3, 3));\r\n        Patch.cachePatch(\"vn_menu_globbed\",\r\n                new Patch(\"campaign/visual_novel/menu/menu_globbed.png\", 9, 9, 3, 3));\r\n        Patch.cachePatch(\"vn_menu_hollow\",\r\n                new Patch(\"campaign/visual_novel/menu/menu_hollow.png\", 9, 9, 3, 3));\r\n        Patch.cacheButtonPatch(\"vn_button\", \"campaign/visual_novel/menu/button/button\");\r\n        Patch.cacheButtonPatch(\"vn_button_full\", \"campaign/visual_novel/menu/button/button_full\");\r\n    }\r\n    private ParallaxBackground background;\r\n    public VnTitleMenu() {\r\n        buttons = new ArrayList<>();\r\n        background = new ParallaxBackground(\"campaign/visual_novel/backgrounds/city\", true);\r\n        int i = 1;\r\n        buttons.add(new MenuButton(\"vn_button\", \"Start Game\", -384 / 2, -32 - 96 * i, 384, 64, () -> {\r\n            program.switchMenu(new VnDialogueMenu(\"city\", \"peepee.dlg\", this));\r\n//            program.switchMenu(new VnOverworldMenu());\r\n        }));\r\n        i++;\r\n        buttons.add(new MenuButton(\"vn_button\", \"To Main Title Screen\", -384 / 2, -32 - 96 * i, 384, 64, () -> {\r\n            program.switchMenu(TitleMenu.titleScreen);\r\n        }));\r\n    }\r\n\r\n    @Override\r\n    public void start() {\r\n        SoundEngine.playMusic(\"themes/dating_theme.ogg\");\r\n    }\r\n\r\n    @Override\r\n    public void update() {\r\n        LittleH.program.dynamicCamera.targetPosition.x += 16;\r\n        buttons.forEach(button -> button.update());\r\n    }\r\n\r\n    @Override\r\n    public void keyDown(int keycode) {\r\n        if (keycode == Input.Keys.ENTER) {\r\n\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void mouseUp(int button) {\r\n        buttons.forEach(menuButton -> menuButton.mouseClicked());\r\n    }\r\n\r\n    @Override\r\n    public void render(Graphics g) {\r\n        LittleH.program.useDynamicCamera();\r\n\r\n        background.render(g);\r\n\r\n        LittleH.program.useStaticCamera();\r\n\r\n        g.setColor(Images.getHColor(0, -0.75f, 0));\r\n        g.draw(Images.getImage(\"campaign/visual_novel/title_color.png\"), -624 / 2, -relZeroY() - 680 - 16, 624, 680);\r\n        g.setColor(Images.getHColor(0, -0.5f, 0));\r\n        g.draw(Images.getImage(\"campaign/visual_novel/title_color_aa.png\"), -624 / 2, -relZeroY() - 680 - 16, 624, 680);\r\n        g.resetColor();\r\n        g.draw(Images.getImage(\"campaign/visual_novel/title.png\"), -624 / 2, -relZeroY() - 680 - 16, 624, 680);\r\n\r\n        buttons.forEach(button -> button.render(g, 4));\r\n    }\r\n}\r\n
===================================================================
diff --git a/core/src/com/sab/littleh/campaign/visual_novel/menu/VnTitleMenu.java b/core/src/com/sab/littleh/campaign/visual_novel/menu/VnTitleMenu.java
--- a/core/src/com/sab/littleh/campaign/visual_novel/menu/VnTitleMenu.java	
+++ b/core/src/com/sab/littleh/campaign/visual_novel/menu/VnTitleMenu.java	
@@ -30,7 +30,7 @@
         background = new ParallaxBackground("campaign/visual_novel/backgrounds/city", true);
         int i = 1;
         buttons.add(new MenuButton("vn_button", "Start Game", -384 / 2, -32 - 96 * i, 384, 64, () -> {
-            program.switchMenu(new VnDialogueMenu("city", "peepee.dlg", this));
+            program.switchMenu(new VnDialogueMenu("city", "overly_long_dialogue.dlg", this));
 //            program.switchMenu(new VnOverworldMenu());
         }));
         i++;
Index: core/src/com/sab/littleh/campaign/visual_novel/menu/VnDialogueMenu.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.sab.littleh.campaign.visual_novel.menu;\r\n\r\nimport com.badlogic.gdx.Input;\r\nimport com.badlogic.gdx.InputMultiplexer;\r\nimport com.sab.littleh.LittleH;\r\nimport com.sab.littleh.campaign.visual_novel.dialogue.VnDialogue;\r\nimport com.sab.littleh.game.entity.Particle;\r\nimport com.sab.littleh.mainmenu.MainMenu;\r\nimport com.sab.littleh.mainmenu.MenuButton;\r\nimport com.sab.littleh.mainmenu.TitleMenu;\r\nimport com.sab.littleh.util.Graphics;\r\nimport com.sab.littleh.util.Images;\r\nimport com.sab.littleh.util.ParallaxBackground;\r\nimport com.sab.littleh.util.Patch;\r\nimport com.sab.littleh.util.dialogue.Dialogue;\r\nimport com.sab.littleh.util.dialogue.Dialogues;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.List;\r\n\r\npublic class VnDialogueMenu extends MainMenu {\r\n    private VnDialogue dialogue;\r\n    private ParallaxBackground background;\r\n    private MainMenu menuBehind;\r\n    private List<Particle> particles;\r\n    private List<ParticleSpawner> particleSpawners;\r\n\r\n    public VnDialogueMenu(String backgroundName, String dialogueName, MainMenu menuBehind) {\r\n        background = new ParallaxBackground(\"campaign/visual_novel/backgrounds/\" + backgroundName, true);\r\n        dialogue = Dialogues.getVnDialogue(\"vn/\" + dialogueName);\r\n        this.menuBehind = menuBehind;\r\n        particles = new ArrayList<>();\r\n        particleSpawners = new ArrayList<>();\r\n    }\r\n\r\n    @Override\r\n    public void start() {\r\n    }\r\n\r\n    @Override\r\n    public void update() {\r\n        LittleH.program.dynamicCamera.targetPosition.x += 8;\r\n        if (dialogue.changedBlock()) {\r\n            particleSpawners.clear();\r\n        }\r\n        dialogue.update();\r\n        dialogue.next();\r\n        if (dialogue != null && dialogue.shouldEnd()) {\r\n            dialogue = null;\r\n            particleSpawners.clear();\r\n        }\r\n        particleSpawners.forEach(ParticleSpawner::update);\r\n        particles.forEach(Particle::update);\r\n        particles.removeIf(particle -> !particle.alive);\r\n\r\n        if (dialogue == null)\r\n            program.switchMenu(menuBehind);\r\n    }\r\n\r\n    @Override\r\n    public void keyDown(int keycode) {\r\n        if (keycode == Input.Keys.ENTER) {\r\n            doDialogue();\r\n        }\r\n    }\r\n\r\n    public void addParticle(Particle particle) {\r\n        particles.add(particle);\r\n    }\r\n\r\n    @Override\r\n    public void mouseUp(int button) {\r\n        if (dialogue.mouseUp())\r\n            doDialogue();\r\n    }\r\n\r\n    public void doDialogue() {\r\n        if (!dialogue.started()) {\r\n            dialogue.start();\r\n        } else {\r\n            if (dialogue != null) {\r\n                if (dialogue.finished()) {\r\n                    program.switchMenu(menuBehind);\r\n                } else if (dialogue.finishedBlock()) {\r\n                    dialogue.nextBlock();\r\n                } else {\r\n                    dialogue.toEnd();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public void render(Graphics g) {\r\n        LittleH.program.useDynamicCamera();\r\n\r\n        background.render(g);\r\n\r\n        LittleH.program.useStaticCamera();\r\n\r\n        if (dialogue != null)\r\n            dialogue.render(g, false);\r\n        particles.forEach(particle -> particle.render(g));\r\n    }\r\n\r\n    public void addParticleSpawner(String type) {\r\n        particleSpawners.add(new ParticleSpawner(type, 60));\r\n    }\r\n\r\n    public void clearParticleSpawners() {\r\n        particleSpawners.clear();\r\n    }\r\n\r\n    private class ParticleSpawner {\r\n        String type;\r\n        int delay;\r\n        int timer;\r\n        ParticleSpawner(String type, int delay) {\r\n            this.type = type;\r\n            this.delay = delay;\r\n            timer = delay;\r\n        }\r\n\r\n        public void update() {\r\n            if (++timer >= delay) {\r\n                dialogue.runCommand(\"sP\", type + \" | 1\");\r\n                timer = 0;\r\n            }\r\n        }\r\n    }\r\n}\r\n
===================================================================
diff --git a/core/src/com/sab/littleh/campaign/visual_novel/menu/VnDialogueMenu.java b/core/src/com/sab/littleh/campaign/visual_novel/menu/VnDialogueMenu.java
--- a/core/src/com/sab/littleh/campaign/visual_novel/menu/VnDialogueMenu.java	
+++ b/core/src/com/sab/littleh/campaign/visual_novel/menu/VnDialogueMenu.java	
@@ -39,7 +39,7 @@
 
     @Override
     public void update() {
-        LittleH.program.dynamicCamera.targetPosition.x += 8;
+        LittleH.program.dynamicCamera.targetPosition.x += 4;
         if (dialogue.changedBlock()) {
             particleSpawners.clear();
         }
